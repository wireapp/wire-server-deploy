####################################################
# minio
####################################################
#
# minio requires at least 2 datadirs (e.g. 2 servers x 1 disk each)
# operating docs: https://docs.minio.io/docs/minio-admin-complete-guide.html
#
- layouts:
  - layout1:
    name: "server1"
    minio_server_addr: ":9000"
    minio_server_datadirs: "/var/lib/minio-server1"
    minio_server_envfile:  "/etc/default/minio-server1"
  - layout2:
    minio_server_addr: ":9001"
    minio_server_datadirs: "/var/lib/minio-server2"
    minio_server_envfile:  "/etc/default/minio-server2"

- hosts: minio
  any_errors_fatal: true
  become: true
  gather_facts: true
  vars:
    minio_server_env_extra: "MINIO_BROWSER=off"
  pre_tasks:
    - debug: var=minio_server_cluster_nodes
      run_once: true
  roles:

# Commented out for now. should not depend on hostname.
#    - role: hostname
#      tags:
#        - hostname

# Also commented out. ntp broken?
#     - role: ansible-role-ntp
#       tags:
#         - ntp
    - role: ansible-minio
      layout: layout1
      tags:
        - minio
    - role: ansible-minio
      layout: layout2
      tags:
        - minio
