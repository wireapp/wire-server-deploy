---
# This assumes you ran "make download" to download the kubespray files
#
- import_playbook: roles-external/kubespray/cluster.yml

- hosts: etcd
  environment: "{{ proxy_env | default({}) }}"
  roles:
    - etcd-helpers

- hosts: k8s-cluster
  environment: "{{ proxy_env | default({}) }}"
  roles:
    - role: logrotate
      logrotate_scripts:
        # The following will rotate pod logs once per day to keep no more than
        # 3 days (maxage 1, rotate 2) of logs for data minimization/protection
        # reasons.
        - name: podlogs
          path: "/var/lib/docker/containers/*/*.log"
          options:
            - daily
            - missingok
            - rotate 2
            - maxage 1
            - copytruncate
            - nocreate
            - nocompress
